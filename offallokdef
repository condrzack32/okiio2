@echo off
if "%1"=="hidden" goto :run
start /min cmd.exe /c "%~f0" hidden
exit

:run
title Disable Windows Defender & Windows Update COMPLETELY
echo ====== Vô hiệu hoá Windows Defender + Windows Update ======

:: ------------------ TẮT WINDOWS DEFENDER ------------------ ::
sc stop WinDefend
sc config WinDefend start= disabled

REG ADD "HKLM\SOFTWARE\Policies\Microsoft\Windows Defender" /v DisableAntiSpyware /t REG_DWORD /d 1 /f

:: Real-Time Protection
REG ADD "HKLM\SOFTWARE\Policies\Microsoft\Windows Defender\Real-Time Protection" /v DisableRealtimeMonitoring /t REG_DWORD /d 1 /f
REG ADD "HKLM\SOFTWARE\Policies\Microsoft\Windows Defender\Real-Time Protection" /v DisableIOAVProtection /t REG_DWORD /d 1 /f
REG ADD "HKLM\SOFTWARE\Policies\Microsoft\Windows Defender\Real-Time Protection" /v DisableOnAccessProtection /t REG_DWORD /d 1 /f
REG ADD "HKLM\SOFTWARE\Policies\Microsoft\Windows Defender\Real-Time Protection" /v DisableScriptScanning /t REG_DWORD /d 1 /f

:: Cloud & Sample Submission
REG ADD "HKLM\SOFTWARE\Policies\Microsoft\Windows Defender\Spynet" /v SpynetReporting /t REG_DWORD /d 0 /f
REG ADD "HKLM\SOFTWARE\Policies\Microsoft\Windows Defender\Spynet" /v SubmitSamplesConsent /t REG_DWORD /d 2 /f

:: Ẩn thông báo, khoá UI, ngăn bật lại
REG ADD "HKLM\SOFTWARE\Policies\Microsoft\Windows Defender Security Center\Notifications" /v DisableEnhancedNotifications /t REG_DWORD /d 1 /f
REG ADD "HKLM\SOFTWARE\Policies\Microsoft\Windows Defender Security Center\App" /v UILockdown /t REG_DWORD /d 1 /f
REG ADD "HKLM\SOFTWARE\Microsoft\Windows Defender\Features" /v TamperProtection /t REG_DWORD /d 0 /f

:: ------------------ TẮT WINDOWS UPDATE ------------------ ::
sc stop wuauserv
sc config wuauserv start= disabled

sc stop bits
sc config bits start= disabled

sc stop UsoSvc
sc config UsoSvc start= disabled

REG ADD "HKLM\SOFTWARE\Policies\Microsoft\Windows\WindowsUpdate\AU" /v NoAutoUpdate /t REG_DWORD /d 1 /f
REG ADD "HKLM\SOFTWARE\Policies\Microsoft\Windows\WindowsUpdate" /v DoNotConnectToWindowsUpdateInternetLocations /t REG_DWORD /d 1 /f

:: Gỡ quyền sửa Windows Update (không cho thay đổi lại)
takeown /f "%windir%\System32\Tasks\Microsoft\Windows\WindowsUpdate" /r /d y >nul 2>&1
icacls "%windir%\System32\Tasks\Microsoft\Windows\WindowsUpdate" /deny "Everyone":F >nul 2>&1

echo.
echo .
echo 
pause
